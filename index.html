<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Purple Rain</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Montserrat:wght@300;500&display=swap" rel="stylesheet">

<style>
:root {
  --bg1:#2a003d;
  --bg2:#120018;
  --glow:#b266ff;
  --text:#f6ebff;
}

* { box-sizing:border-box; }

body {
  margin:0;
  background:radial-gradient(circle at top,#3d0066,var(--bg2));
  color:var(--text);
  font-family:Montserrat,sans-serif;
  overflow:hidden;
}

canvas {
  position:fixed;
  inset:0;
  z-index:0;
}

main {
  position:relative;
  z-index:1;
  height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:2rem;
  text-align:center;
}

h1 {
  font-family:"Playfair Display",serif;
  letter-spacing:0.2em;
  margin-bottom:1rem;
  text-shadow:0 0 25px var(--glow);
}

#lyrics {
  font-size:1.25rem;
  max-width:720px;
  min-height:4em;
  line-height:1.6;
  opacity:0;
  transition:opacity 0.6s ease;
}

#lyrics.active { opacity:1; }

.controls {
  margin-top:1.8rem;
  display:flex;
  align-items:center;
  gap:1rem;
  width:100%;
  max-width:720px;
}

button {
  background:none;
  border:none;
  color:var(--text);
  font-size:1.7rem;
  cursor:pointer;
  transition:0.2s;
}

button:hover { color:var(--glow); }

.progress-container {
  flex:1;
  background:rgba(255,255,255,0.25);
  height:8px;
  border-radius:4px;
  cursor:pointer;
  position:relative;
}

.progress {
  height:100%;
  width:0%;
  border-radius:4px;
  background:linear-gradient(90deg,#7f2fff,var(--glow));
  box-shadow:0 0 12px var(--glow);
}

.time {
  font-size:0.9rem;
  white-space:nowrap;
  opacity:0.85;
}

#overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.8);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:5;
}

#overlay button {
  border:2px solid var(--glow);
  padding:1rem 2.5rem;
  font-size:1.1rem;
  letter-spacing:0.15em;
  box-shadow:0 0 30px rgba(178,102,255,0.7);
}

iframe { display:none; }
</style>
</head>
<body>

<canvas id="rain"></canvas>

<div id="overlay">
  <button id="startBtn">ENTER THE PURPLE RAIN</button>
</div>

<main>
  <h1>PURPLE RAIN</h1>
  <div id="lyrics"></div>

  <div class="controls">
    <button id="playPause">▶</button>

    <div class="progress-container" id="progressContainer">
      <div class="progress" id="progress"></div>
    </div>

    <div class="time" id="time">0:00 / 0:00</div>
  </div>
</main>

<div id="player"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
/* ================= YOUTUBE AUDIO ================= */
const VIDEO_ID = "iSBVeZrDfGY";
let player;

function onYouTubeIframeAPIReady() {
  player = new YT.Player("player", {
    videoId: VIDEO_ID,
    playerVars: {
      autoplay:1,
      controls:0,
      rel:0,
      modestbranding:1,
      mute:1,
      playsinline:1
    },
    events:{ onReady:init }
  });
}

document.getElementById("startBtn").onclick = () => {
  player.unMute();
  document.getElementById("overlay").style.display="none";
};

/* ================= CONTROLS ================= */
const playPause = document.getElementById("playPause");
const progressContainer = document.getElementById("progressContainer");
const progress = document.getElementById("progress");
const timeDisplay = document.getElementById("time");

function init() {
  playPause.onclick = () => {
    if(player.getPlayerState() === YT.PlayerState.PLAYING) {
      player.pauseVideo();
    } else {
      player.playVideo();
    }
  };

  progressContainer.onclick = e => {
    const r = progressContainer.getBoundingClientRect();
    const pct = (e.clientX - r.left) / r.width;
    player.seekTo(player.getDuration() * pct, true);
  };

  setInterval(updateUI, 300);
}

function updateUI() {
  if(!player.getDuration) return;

  const cur = player.getCurrentTime();
  const dur = player.getDuration();

  progress.style.width = (cur / dur * 100) + "%";
  timeDisplay.textContent = format(cur) + " / " + format(dur);

  playPause.textContent =
    player.getPlayerState() === YT.PlayerState.PLAYING ? "❚❚" : "▶";
}

function format(t) {
  const m = Math.floor(t / 60);
  const s = Math.floor(t % 60).toString().padStart(2,"0");
  return `${m}:${s}`;
}

/* ================= LYRICS ================= */
const lyrics = [
  { time: 48, text: "I never meant to cause you any sorrow" },
  { time: 55, text: "I never meant to cause you any pain" },
  { time: 62, text: "I only wanted, one time, to see you laughing" },
  { time: 71, text: "I only want to see you laughing" },
  { time: 78, text: "In the purple rain" },

  { time: 92, text: "Purple rain, purple rain" },
  { time: 100, text: "Purple rain, purple rain" },
  { time: 108, text: "Purple rain, purple rain" },
  { time: 116, text: "I only want to see you bathing" },
  { time: 123, text: "In the purple rain" },

  { time: 155, text: "I never wanted to be your weekend lover" },
  { time: 163, text: "I only wanted to be some kind of friend, hey" },
  { time: 173, text: "Baby, I could never steal you from another" },
  { time: 182, text: "It's such a shame our friendship had to end" },

  { time: 202, text: "Purple rain, purple rain" },
  { time: 210, text: "Purple rain, purple rain" },
  { time: 218, text: "Purple rain, purple rain" },
  { time: 226, text: "I only want to see you underneath the purple rain" },

  { time: 260, text: "Honey, I know, I know, I know times are changing" },
  { time: 269, text: "It's time we all reach out for something new" },
  { time: 277, text: "That means you, too" },
  { time: 284, text: "You say you want a leader" },
  { time: 291, text: "But you can't seem to make up your mind" },
  { time: 299, text: "I think you better close it" },
  { time: 305, text: "And let me guide you to the purple rain" },

  { time: 328, text: "Purple rain, purple rain, yeah" },
  { time: 336, text: "Purple rain, purple rain, woo!" },
  { time: 345, text: "I only want to see you" },
  { time: 352, text: "Only want to see you in the purple rain" }
];

const lyricBox = document.getElementById("lyrics");
let lastLine = -1;

setInterval(() => {
  if(!player || !player.getCurrentTime) return;
  const t = player.getCurrentTime();

  for(let i = lyrics.length - 1; i >= 0; i--) {
    if(t >= lyrics[i].time && lastLine !== i) {
      lastLine = i;
      lyricBox.classList.remove("active");
      setTimeout(() => {
        lyricBox.textContent = lyrics[i].text;
        lyricBox.classList.add("active");
      }, 200);
      break;
    }
  }
}, 300);

/* ================= PURPLE RAIN VISUAL ================= */
const canvas = document.getElementById("rain");
const ctx = canvas.getContext("2d");
let drops=[];

function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
  drops = Array.from({length:canvas.width/18},()=>({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    l:Math.random()*20+10,
    s:Math.random()*4+2
  }));
}
window.addEventListener("resize",resize);
resize();

function rain(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle="rgba(178,102,255,0.35)";
  ctx.lineWidth=1;
  drops.forEach(d=>{
    ctx.beginPath();
    ctx.moveTo(d.x,d.y);
    ctx.lineTo(d.x,d.y+d.l);
    ctx.stroke();
    d.y+=d.s;
    if(d.y>canvas.height) d.y=-20;
  });
  requestAnimationFrame(rain);
}
rain();
</script>

</body>
</html>
